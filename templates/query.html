<!DOCTYPE html>
<html >
    <head>
        <meta charset="UTF-8">
        <title>三螺旋小世界专利搜索平台</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
        <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    </head>
    <body>
        <!--总体布局-->
        <div class="container">
            <!--主体内容-->
            <div id="page-wrapper" style="margin-top: 40px;" >
                <!-- 数据 -->
                <div class="panel panel-default">
                    <div class="panel-body">
                        <form class="form-inline" action="" method="get">
                            <div class="form-group">
                                <div style="margin-left: 25px">
                                     <label>TOP-K：</label>
                                    <input type="text" class="form-control" id= "n" name="n" placeholder="TOP-K" style="width: auto;margin-left: 30px">
                                </div>
                                <div style="margin-top: 20px">
                                    <label>请输入搜索内容：</label>
                                    <textarea type="text" class="form-control" id= "s" name="s" placeholder="请输入搜索内容" style="width: 400px;height: 80px;"></textarea>
                                </div>
                            </div>
                            <div style="margin-top: 20px;margin-left: 80px">
                                <button type="button" class="btn btn-primary" id="query_patent" style="width: 100px">搜索</button>
                                <button type="reset" class="btn btn-primary" id="re_patent" style="width: 100px;margin-left: 40px">重置</button>
                            </div>
                        </form>
                    </div>
                </div>
                <!--搜素查询结束-->
                <!--搜素详情-->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">搜索结果</div>
                            <!-- 信息 -->
                            <div class="table-responsive" >
                                <table id="orderInfo"  class="table table-striped data" style="margin-bottom: 0px;">
                                    <thead>
                                        <tr>
                                            <th>ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;内容</th>
                                        </tr>
                                    </thead>
                                    <tbody id="searchList">

                                    </tbody>
                                </table>
                            </div>
                            <!--导航条-->
                            <div class="pageRow">
                                <div id="pageination" style="float: right;border-top: 20px;margin-top: 20px"></div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script>
        $(function() {
            //鼠标点击的时候搜索
            $("#query_patent").click(function () {
                var n = $('#n').val();
                var s = $('#s').val();
                $.ajax({
                    type: "post",
                    url: "/api/v0.1/query",
                    data: {
                        "n": n,
                        "s": s
                    },
                    success: function (data) {
                        console.log(data["txt"])
                        $('#searchList').empty();
                        let reg = /\'\"([^\"]*)\"\'/gs
                        let arr = data["txt"].matchAll(/\'\"([^\"]*)\"\'/g)
                        console.log(Array.from(arr, x => x[0]));
                        var i=1
                        while(crr = reg.exec(data["txt"])){
                            var lielem = '<tr><td>'+i+ '</td><td>'+ crr[1]+ '</td></tr>'
                            $('#searchList').append(lielem);
                            i = i+1
                        }
                        //位置1  对数据进行分页
                        $('#pageination').show();
                        pagination(5, 1);

                    }
                });
            });
            //列表分页
            //perPage 每一页显示条数     current：当前第几页
            function pagination(perPage, current) {
                var tableData = document.getElementById("searchList");
                var totalCount = tableData.rows.length;  //总条数

                //设置表格总页数
                var totalPage = 0;//列表的总页数
                var pageSize = perPage;
                if (totalCount / pageSize > parseInt(totalCount / pageSize)) {
                    totalPage = parseInt(totalCount / pageSize) + 1;
                } else {
                    totalPage = parseInt(totalCount / pageSize);
                }
                //对数据进行分页
                var currentPage = current;
                var startRow = (currentPage - 1) * pageSize + 1;
                var endRow = (currentPage * pageSize > totalCount ? totalCount : currentPage * pageSize);

                for (var i = 1; i < (totalCount + 1); i++) {
                    var irow = tableData.rows[i - 1];
                    if (i >= startRow && i <= endRow) {
                        irow.style.display = "block";
                    } else {
                        irow.style.display = "none";
                    }
                }
                //位置2 生成当前的点击按钮
                createBtns(totalPage, current);
                //位置3  绑定点击事件
                bindClick(totalPage);

            }

            //生成点击按钮
            //totalPages 分页的总页数
            //current当前页
            function createBtns(totalPages, current) {
                var tempStr = "";
                /*上一页按钮*/
                if (current > 1) {
                    /* tempStr += "<span class='btn first' href=\"#\"  data-page = '1'>首页</span>";*/
                    tempStr += "<span class='btn prev' href=\"#\" data-page = " + (current - 1) + ">上一页</span>"
                }
                /*中间页码的显示*/
                /*如果总页数超出5个处理办法*/
                if (totalPages <= 5) {
                    for (var pageIndex = 1; pageIndex < totalPages + 1; pageIndex++) {
                        tempStr += "<a  class='btn page" + pageIndex + "'  data-page = " + (pageIndex) + "><span>" + pageIndex + "</span></a>";
                    }
                } else {
                    if (current < 5) {
                        for (var pageIndex = 1; pageIndex < 5; pageIndex++) {
                            tempStr += "<a  class='btn page" + pageIndex + "'  data-page = " + (pageIndex) + "><span>" + pageIndex + "</span></a>";
                        }
                        tempStr += '<span>......</span>';
                        tempStr += "<a  class='btn page" + totalPages + "'  data-page = " + (totalPages) + "><span>" + totalPages + "</span></a>";
                    } else if (current >= totalPages - 4) {
                        tempStr += "<a  class='btn page" + 1 + "'  data-page = " + (1) + "><span>" + 1 + "</span></a>";
                        tempStr += '<span>......</span>';
                        for (var pageIndex = totalPages - 4; pageIndex <= totalPages; pageIndex++) {
                            tempStr += "<a  class='btn page" + pageIndex + "'  data-page = " + (pageIndex) + "><span>" + pageIndex + "</span></a>";
                        }
                    } else if (current >= 5 && current < totalPages - 4) {
                        tempStr += "<a  class='btn page" + 1 + "'  data-page = " + (1) + "><span>" + 1 + "</span></a>";
                        tempStr += '<span>......</span>';
                        for (var pageIndex = current; pageIndex <= current + 4; pageIndex++) {
                            tempStr += "<a  class='btn page" + pageIndex + "'  data-page = " + (pageIndex) + "><span>" + pageIndex + "</span></a>";
                        }
                        tempStr += '<span>......</span>';
                        tempStr += "<a  class='btn page" + totalPages + "'  data-page = " + (totalPages) + "><span>" + totalPages + "</span></a>";
                    }
                }
                /*下一页按钮*/
                if (current < totalPages) {
                    tempStr += "<span class='btn next' href=\"#\"  data-page = " + (current + 1) + ">下一页</span>";
                    /*            tempStr += "<span class='btn last' href=\"#\" data-page = "+ (totalPages) +">尾页</span>";*/
                }
                document.getElementById("pageination").innerHTML = tempStr;
            }

            function bindClick(totalPage) {
                // 设置首页、末页、上一页、下一页的点击事件
                var buttonArr = ['first', 'last', 'prev', 'next'];
                for (var k in buttonArr) {
                    var $dom = '.' + buttonArr[k];
                    $('body').delegate($dom, 'click', function () {
                        var data = $(this).data('page');//获取当前按钮跳转的页数
                        pagination('5', data);//对页面进行分页
                        //对当前页码的样式做处理
                        $('.page' + data).css({
                            background: '#0449d4',
                            color: '#fff'
                        }).siblings().css({background: '#fff', color: '#999'});
                    })
                }

                // 设置数码的点击事件 totalImgPage是总页数，为全局变量，在分页时被赋值
                for (var k = 1; k <= totalPage; k++) {
                    var $singleDom = '.page' + k;
                    $('body').delegate($singleDom, 'click', function () {
                        var data = $(this).data('page');
                        pagination('5', data);//对页面进行分页
                        //对当前页码的样式做处理
                        $('.page' + data).css({
                            background: '#0449d4',
                            color: '#fff'
                        }).siblings().css({background: '#fff', color: '#999'});
                    })
                }
            }
        });
    </script>
</html>

